<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Dodva ç¤¾åŒº Â· BBS MVP</title><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><style>:root{--bg:#0b0f1a;--fg:#eaf2ff;--line:rgba(147,197,253,.18)}*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans SC",sans-serif}header{position:sticky;top:0;padding:10px 16px;background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35));border-bottom:1px solid var(--line);display:flex;gap:10px;align-items:center}.wrap{max-width:1000px;margin:0 auto;padding:16px}.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}.pill{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:rgba(147,197,253,.06);color:#eaf2ff;cursor:pointer;text-decoration:none}.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:10px}.card{border:1px solid var(--line);border-radius:12px;padding:12px;background:rgba(147,197,253,.06)}.muted{opacity:.75}input,select,textarea{width:100%;padding:8px;border-radius:10px;border:1px solid var(--line);background:rgba(147,197,253,.06);color:#eaf2ff}textarea{min-height:120px}.meta{font-size:12px;opacity:.75}.link{color:#93c5fd}</style></head><body><header><div>ğŸŒ† ç¤¾åŒºBBS</div><div class=row style=margin-left:auto><span id=who class=muted>æœªç™»å½•</span> <button id=btnLogin class=pill>ç™»å½•/æ³¨å†Œ</button> <button id=btnLogout class=pill style=display:none>é€€å‡º</button></div></header><div class=wrap><section class=card><div class=row><select id=boardSel></select> <input id=title placeholder="æ ‡é¢˜ï¼ˆå¦‚ï¼šSoHo åº—é“ºå‡ºç§Ÿ 7200sqf/æ¯æœˆ$4200ï¼‰"></div><div class=row style=margin-top:8px><textarea id=body placeholder=å†…å®¹æ”¯æŒç®€è¦ä¿¡æ¯ï¼ˆä½ç½®/é¢ç§¯/ç§Ÿé‡‘/è”ç³»æ–¹å¼ï¼‰æˆ–ä»»æ„æè¿°ã€‚></textarea></div><div class=row style=margin-top:8px><button id=btnPost class=pill>å‘å¸ƒ</button> <span class=muted>ç™»å½•åå¯å‘å¸–ï¼›å‘å‡ºå³åˆ»å¯è§ã€‚</span></div></section><h3 style="margin:14px 0 8px">ğŸ“Œ æœ€æ–°å¸–å­</h3><div id=threadList class=grid></div><section id=threadDetail class=card style=display:none;margin-top:14px><div id=tdTitle style=font-weight:800></div><div id=tdMeta class=meta></div><div id=tdBody style="margin:8px 0 12px;white-space:pre-wrap"></div><div class=row><textarea id=replyBody placeholder=å›å¤å†…å®¹â€¦></textarea> <button id=btnReply class=pill>å›å¸–</button></div><div id=replyList style=margin-top:10px></div></section></div><script type=module>import{createClient}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const SUPABASE_URL="https://ijwamnzsyqpufkqgwvzi.supabase.co",SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd2FtbnpzeXFwdWZrcWd3dnppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MjA3MTAsImV4cCI6MjA3MTE5NjcxMH0.-7zCB0MVmT0ki-eNUIuMvjNY0TbtxsnVHZv7h3qfJCA",sb=createClient(SUPABASE_URL,SUPABASE_ANON_KEY),$=e=>document.querySelector(e),who=$("#who"),btnLogin=$("#btnLogin"),btnLogout=$("#btnLogout"),boardSel=$("#boardSel"),titleEl=$("#title"),bodyEl=$("#body"),threadList=$("#threadList"),detail=$("#threadDetail"),tdTitle=$("#tdTitle"),tdMeta=$("#tdMeta"),tdBody=$("#tdBody"),replyBody=$("#replyBody"),btnReply=$("#btnReply");let me=null,currentThreadId=null;async function loadBoards(){const{data:e,error:t}=await sb.from("boards").select("*").eq("is_hidden",!1).order("id");if(t)return console.error(t);boardSel.innerHTML=e.map(e=>`<option value="${e.id}">${e.name}</option>`).join("")}async function publishThread(){if(!me)return void alert("è¯·å…ˆç™»å½•");const e=parseInt(boardSel.value,10),t=titleEl.value.trim(),a=bodyEl.value.trim();if(!t)return alert("è¯·å¡«å†™æ ‡é¢˜");const{error:n}=await sb.from("threads").insert({board_id:e,title:t,body:a,author:me.id});if(n)return alert("å‘å¸ƒå¤±è´¥ï¼š"+n.message);titleEl.value="",bodyEl.value="",await loadThreads()}async function loadThreads(){const{data:e,error:t}=await sb.from("threads").select("id,title,created_at,is_pinned,boards(name),profiles:author(nickname)").order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1}).limit(20);t?console.error(t):(threadList.innerHTML=e.map(e=>`\n    <article class="card">\n      <div style="display:flex;justify-content:space-between;align-items:center">\n        <a href="#" class="link" data-id="${e.id}">${e.is_pinned?"ğŸ“Œ ":""}${e.title}</a>\n        <span class="meta">${new Date(e.created_at).toLocaleString()}</span>\n      </div>\n      <div class="meta">${e.profiles?.nickname||"åŒ¿å"} Â· ${e.boards?.name||""}</div>\n    </article>\n  `).join(""),threadList.querySelectorAll("a[data-id]").forEach(e=>{e.onclick=t=>{t.preventDefault(),openThread(parseInt(e.dataset.id,10))}}))}async function openThread(e){currentThreadId=e;const{data:t,error:a}=await sb.from("threads").select("id,title,body,created_at,profiles:author(nickname)").eq("id",e).single();if(a)return void console.error(a);tdTitle.textContent=t.title,tdMeta.textContent=`${t.profiles?.nickname||"åŒ¿å"} Â· ${new Date(t.created_at).toLocaleString()}`,tdBody.textContent=t.body||"",detail.style.display="block";const{data:n,error:r}=await sb.from("posts").select("id,body,created_at,profiles:author(nickname)").eq("thread_id",e).order("created_at");r?console.error(r):renderReplies(n||[])}function renderReplies(e){$("#replyList").innerHTML=e.map(e=>`\n    <div style="border-top:1px solid var(--line);padding:8px 0">\n      <div class="meta">${e.profiles?.nickname||"åŒ¿å"} Â· ${new Date(e.created_at).toLocaleString()}</div>\n      <div style="white-space:pre-wrap">${e.body}</div>\n    </div>\n  `).join("")}sb.auth.onAuthStateChange((e,t)=>{me=t?.user||null,who.textContent=me?me.email||"å·²ç™»å½•":"æœªç™»å½•",btnLogin.style.display=me?"none":"inline-block",btnLogout.style.display=me?"inline-block":"none"}),btnLogin.onclick=async()=>{const e=prompt("è¾“å…¥é‚®ç®±ç”¨äºç™»å½•/æ³¨å†Œï¼ˆå°†å‘é€é­”æ³•é“¾æ¥ï¼‰ï¼š");if(!e)return;const{error:t}=await sb.auth.signInWithOtp({email:e});alert(t?"å‘é€å¤±è´¥ï¼š"+t.message:"å·²å‘é€ç™»å½•é‚®ä»¶ï¼Œè¯·æŸ¥æ”¶ã€‚")},btnLogout.onclick=async()=>{await sb.auth.signOut(),location.reload()},btnReply.onclick=async()=>{if(!me)return void alert("è¯·å…ˆç™»å½•");if(!currentThreadId)return;const e=replyBody.value.trim();if(!e)return;const{error:t}=await sb.from("posts").insert({thread_id:currentThreadId,body:e,author:me.id});if(t)return alert("å›å¤å¤±è´¥ï¼š"+t.message);replyBody.value="",openThread(currentThreadId)},$("#btnPost").onclick=publishThread,async function(){sb.auth.getUser().then(async({data:e})=>{const t=e?.user?.id;if(t){const{data:a}=await sb.from("profiles").select("user_id").eq("user_id",t).maybeSingle();a||await sb.from("profiles").insert({user_id:t,nickname:(e.user.email||"ç”¨æˆ·").split("@")[0]})}}),await loadBoards(),await loadThreads()}()</script><script src=https://unpkg.com/@supabase/supabase-js@2></script><script>const supabase=supabase.createClient("ä½ çš„SUPABASE_URL","ä½ çš„PUBLIC_ANON_KEY");async function sendMagicLink(e){const{error:a}=await supabase.auth.signInWithOtp({email:e,options:{emailRedirectTo:`${location.origin}/bbs.html`}});a?alert("å‘é€å¤±è´¥ï¼š"+a.message):alert("å·²å‘é€ç™»å½•é“¾æ¥ï¼Œè¯·æŸ¥æ”¶é‚®ç®±")}(async()=>{if(/code=|access_token=/.test(location.href)){const{data:e,error:a}=await supabase.auth.exchangeCodeForSession(location.href);a?alert("ç™»å½•å›è°ƒå¤±è´¥ï¼š"+a.message):(console.log("ç™»å½•æˆåŠŸ",e.session?.user),history.replaceState({},"",location.pathname))}})()</script></body></html>